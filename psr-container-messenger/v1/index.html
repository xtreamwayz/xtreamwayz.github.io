<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Getting started &ndash; xtreamwayz</title><link rel=stylesheet href=https://xtreamwayz.github.io/style/main.min.fcc5a0d27d4fb7bb4c579b90a4c6b268f272ca11a1b5a3ad5e05e681df327ad8930804018fad301683d9ef6b6cf50763dd1d6213c3a69ae0f81dce939bf165d4.css integrity="sha512-/MWg0n1Pt7tMV5uQpMayaPJyyhGhtaOtXgXmgd8yetiTCAQBj60wFoPZ72ts9Qdj3R1iE8OmmuD4Hc6Tm/Fl1A==" media=screen></head><body class=app><header class="app-header navbar navbar-expand navbar-dark bg-dark text-white"><nav class="nav-container container"><a class="navbar-brand text-primary text-uppercase font-weight-bold" href=https://xtreamwayz.github.io/ aria-label="It starts with an idea">xtreamwayz</a><ul class="navbar-nav mr-auto"><li class="nav-item dropdown"><a class="nav-item nav-link dropdown-toggle mr-md-2" href=# id=bd-projects data-toggle=dropdown aria-haspopup=true aria-expanded=false>psr-container-messenger</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=bd-projects><a class=dropdown-item href=https://xtreamwayz.github.io/psr-container-messenger/>psr-container-messenger</a>
<a class=dropdown-item href=https://xtreamwayz.github.io/html-form-validator/>html-form-validator</a>
<a class=dropdown-item href=https://xtreamwayz.github.io/mezzio-console/>mezzio-console</a></div></li><div class=dropdown><a class="nav-item nav-link mr-md-2 dropdown-toggle" href=# role=button id=header-psr-container-messenger-v1 data-toggle=dropdown aria-haspopup=true aria-expanded=false>Version v1</a><div class=dropdown-menu aria-labelledby=header-psr-container-messenger-v1><a class=dropdown-item href=https://xtreamwayz.github.io/psr-container-messenger/latest/>Latest (v2)</a>
<a class=dropdown-item href=https://xtreamwayz.github.io/psr-container-messenger/v1/>v1</a></div></div></ul></nav></header><main class=app-content><article class=container><header><h1>Getting started</h1></header><div class=d-flex><div class=flex-grow-1><nav id=TableOfContents><ul><li><a href=#installation>Installation</a></li><li><a href=#command-query-and-event-buses>Command, Query and Event buses</a></li><li><a href=#configuration>Configuration</a><ul><li><a href=#using-the-bus-in-your-middleware-or-handler>Using the bus in your middleware or handler</a></li></ul></li></ul></nav></div><nav class="nav flex-column nav-pills mb-4"><a class="nav-link btn btn-sm btn-primary m-1" href=https://github.com/xtreamwayz/psr-container-messenger>Source</a>
<a class="nav-link btn btn-sm btn-primary m-1" href="https://github.com/xtreamwayz/psr-container-messenger/issues/new?template=bug-report.md&title=docs:%20issue%20with%20psr-container-messenger%2fv1%2f_index.md">Report issue</a></nav></div><p>This packages brings message buses to your Zend Expressive project. Basically it&rsquo;s a bundle of factories to make
life easier for you. The real work is done by <a href=https://github.com/symfony/messenger>Symfony Messenger</a>.</p><p>It comes with pre-configured command, event and query buses for your convenience. Or don&rsquo;t use them if you want to
create your own. Transports can be used to queue your messages or send and receive them to/from 3rd party applications.</p><blockquote><p><strong>NOTE:</strong> expressive-messenger has been renamed to psr-container-messenger.</p></blockquote><h2 id=installation>Installation</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>composer require xtreamwayz/expressive-messenger
</code></pre></td></tr></table></div></div><p>If you have the <a href=https://github.com/zendframework/zend-component-installer>zend-component-installer</a> installed, the
configuration is added automatically added to your expressive application.</p><h2 id=command-query-and-event-buses>Command, Query and Event buses</h2><p>By default there are 3 buses registered.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php>// Each dispatched command must have one handler
$commandBus = $container-&gt;get(&#39;messenger.command.bus&#39;);

// Each dispatched event may have zero or more handlers
$eventBus = $container-&gt;get(&#39;messenger.event.bus&#39;);

// Each dispatched query must have one handler and returns a result
$queryBus = $container-&gt;get(&#39;messenger.query.bus&#39;);
</code></pre></td></tr></table></div></div><p>There is no middleware configured. You need to add this your self as the order is important. Look at the examples
to get some ideas.</p><h2 id=configuration>Configuration</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=cp>&lt;?php</span>

<span class=k>declare</span><span class=p>(</span><span class=nx>strict_types</span><span class=o>=</span><span class=mi>1</span><span class=p>);</span>

<span class=k>namespace</span> <span class=nx>App</span><span class=p>;</span>

<span class=k>use</span> <span class=nx>App\Domain\Command\RegisterUser</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Event\UserRegistered</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Handler\FindUserHandler</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Handler\FindUserHandlerFactory</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Handler\RegisterUserHandler</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Handler\RegisterUserHandlerFactory</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Handler\UserRegisteredHandler</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Handler\UserRegisteredHandlerFactory</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domain\Query\FindUser</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Xtreamwayz\Expressive\Messenger\Container\TransportFactory</span><span class=p>;</span>

<span class=k>return</span> <span class=p>[</span>
    <span class=s1>&#39;dependencies&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
        <span class=s1>&#39;factories&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
            <span class=nx>FindUserHandler</span><span class=o>::</span><span class=na>class</span>       <span class=o>=&gt;</span> <span class=nx>FindUserHandlerFactory</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
            <span class=nx>RegisterUserHandler</span><span class=o>::</span><span class=na>class</span>   <span class=o>=&gt;</span> <span class=nx>RegisterUserHandlerFactory</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
            <span class=nx>UserRegisteredHandler</span><span class=o>::</span><span class=na>class</span> <span class=o>=&gt;</span> <span class=nx>UserRegisteredHandlerFactory</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>

            <span class=s1>&#39;messenger.transport.redis&#39;</span>  <span class=o>=&gt;</span> <span class=p>[</span><span class=nx>TransportFactory</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;redis:&#39;</span><span class=p>],</span>

            <span class=nx>LoggerInterface</span><span class=o>::</span><span class=na>class</span>       <span class=o>=&gt;</span> <span class=nx>MyLoggerFactory</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
        <span class=p>],</span>
    <span class=p>],</span>

    <span class=s1>&#39;messenger&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
        <span class=s1>&#39;default_bus&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;messenger.command.bus&#39;</span><span class=p>,</span>
        <span class=c1>// (optionally) attach a logger to the send/handle middleware and console commands
</span><span class=c1></span>        <span class=s1>&#39;logger&#39;</span>      <span class=o>=&gt;</span> <span class=nx>LoggerInterface</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
        <span class=s1>&#39;buses&#39;</span>       <span class=o>=&gt;</span> <span class=p>[</span>
            <span class=c1>// Command bus
</span><span class=c1></span>            <span class=s1>&#39;messenger.bus.command&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
                <span class=s1>&#39;allows_no_handler&#39;</span> <span class=o>=&gt;</span> <span class=k>false</span><span class=p>,</span>
                <span class=s1>&#39;handlers&#39;</span>   <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// A command must have one handler
</span><span class=c1></span>                    <span class=nx>RegisterUser</span><span class=o>::</span><span class=na>class</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=nx>RegisterUserHandler</span><span class=o>::</span><span class=na>class</span><span class=p>]</span>
                <span class=p>],</span>
                <span class=s1>&#39;middleware&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// Add custom middleware
</span><span class=c1></span>                    <span class=nx>ValidationMiddleware</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
                    <span class=s1>&#39;messenger.command.middleware.sender&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;messenger.command.middleware.handler&#39;</span><span class=p>,</span>
                <span class=p>],</span>
                <span class=s1>&#39;routes&#39;</span>     <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// Transport routes to senders (queue, 3rd party, https endpoint)
</span><span class=c1></span>                    <span class=nx>RegisterUser</span><span class=o>::</span><span class=na>class</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;messenger.transport.redis&#39;</span><span class=p>]</span>
                <span class=p>],</span>
            <span class=p>],</span>
            <span class=c1>// Event bus
</span><span class=c1></span>            <span class=s1>&#39;messenger.event.bus&#39;</span>   <span class=o>=&gt;</span> <span class=p>[</span>
                <span class=s1>&#39;allows_no_handler&#39;</span> <span class=o>=&gt;</span> <span class=k>true</span><span class=p>,</span>
                <span class=s1>&#39;handlers&#39;</span>   <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// An event may have multiple handlers
</span><span class=c1></span>                    <span class=nx>UserRegistered</span><span class=o>::</span><span class=na>class</span> <span class=o>=&gt;</span> <span class=p>[</span>
                        <span class=nx>SendTermsEmailHandler</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
                        <span class=nx>SendActivationEmailHandler</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
                    <span class=p>],</span>
                <span class=p>],</span>
                <span class=s1>&#39;middleware&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// Add custom middleware
</span><span class=c1></span>                    <span class=s1>&#39;messenger.event.middleware.sender&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;messenger.event.middleware.handler&#39;</span><span class=p>,</span>
                <span class=p>],</span>
                <span class=s1>&#39;routes&#39;</span>     <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// Transport routes to senders (queue, 3rd party, https endpoint)
</span><span class=c1></span>                <span class=p>],</span>
            <span class=p>],</span>
            <span class=s1>&#39;messenger.query.bus&#39;</span>   <span class=o>=&gt;</span> <span class=p>[</span>
                <span class=s1>&#39;allows_no_handler&#39;</span> <span class=o>=&gt;</span> <span class=k>false</span><span class=p>,</span>
                <span class=s1>&#39;handlers&#39;</span>   <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=nx>FindUser</span><span class=o>::</span><span class=na>class</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=nx>FindUserHandler</span><span class=o>::</span><span class=na>class</span><span class=p>]</span>
                <span class=p>],</span>
                <span class=s1>&#39;middleware&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// Add custom middleware
</span><span class=c1></span>                    <span class=s1>&#39;messenger.query.middleware.sender&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;messenger.query.middleware.handler&#39;</span><span class=p>,</span>
                <span class=p>],</span>
                <span class=s1>&#39;routes&#39;</span>     <span class=o>=&gt;</span> <span class=p>[</span>
                    <span class=c1>// Transport routes to senders (queue, 3rd party, https endpoint)
</span><span class=c1></span>                <span class=p>],</span>
            <span class=p>],</span>
        <span class=p>],</span>
    <span class=p>],</span>
<span class=p>];</span>
</code></pre></td></tr></table></div></div><h3 id=using-the-bus-in-your-middleware-or-handler>Using the bus in your middleware or handler</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=cp>&lt;?php</span>

<span class=k>declare</span><span class=p>(</span><span class=nx>strict_types</span><span class=o>=</span><span class=mi>1</span><span class=p>);</span>

<span class=k>namespace</span> <span class=nx>App\Handler</span><span class=p>;</span>

<span class=k>use</span> <span class=nx>App\Domain\Command\RegisterUser</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Psr\Http\Message\ResponseInterface</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Psr\Http\Message\ServerRequestInterface</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Psr\Http\Server\RequestHandlerInterface</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Ramsey\Uuid\Uuid</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Symfony\Component\Messenger\MessageBusInterface</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Zend\Diactoros\Response\JsonResponse</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>RegisterHandler</span> <span class=k>implements</span> <span class=nx>RequestHandlerInterface</span>
<span class=p>{</span>
    <span class=sd>/** @var MessageBusInterface */</span>
    <span class=k>private</span> <span class=nv>$bus</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>MessageBusInterface</span> <span class=nv>$bus</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>bus</span> <span class=o>=</span> <span class=nv>$bus</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>ServerRequestInterface</span> <span class=nv>$request</span><span class=p>)</span> <span class=o>:</span> <span class=nx>ResponseInterface</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>bus</span><span class=o>-&gt;</span><span class=na>dispatch</span><span class=p>(</span>
            <span class=k>new</span> <span class=nx>RegisterUser</span><span class=p>([</span>
                <span class=s1>&#39;id&#39;</span>       <span class=o>=&gt;</span> <span class=nx>Uuid</span><span class=o>::</span><span class=na>uuid4</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>toString</span><span class=p>(),</span>
                <span class=s1>&#39;email&#39;</span>    <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>getAttribute</span><span class=p>(</span><span class=s1>&#39;email&#39;</span><span class=p>),</span>
                <span class=s1>&#39;password&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>getAttribute</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>),</span>
            <span class=p>])</span>
        <span class=p>);</span>

        <span class=k>return</span> <span class=k>new</span> <span class=nx>JsonResponse</span><span class=p>([],</span> <span class=mi>204</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><footer class="my-5 text-muted">This page, including the code samples, is licensed under the <a href=https://creativecommons.org/licenses/by/4.0/>Creative Commons CC BY 4.0</a> license.</footer></article></main><footer class="app-footer p-3"><div class=container><p class=text-center>&copy; 2016-2020 <a href=https://geerteltink.github.io/>Geert Eltink</a></p></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js integrity=sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-151173516-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>